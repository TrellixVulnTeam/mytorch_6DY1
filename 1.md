## [论文标题]:CAMEL: A Weakly Supervised Learning Framework for Histopathology Image Segmentation

## [论文摘要]

组织病理学图像分析在癌症诊断和治疗中起着至关重要的作用。为了自动分割癌变区域，完全监督分割算法需要在像素级进行劳动密集型和耗时的标记。在本研究中，我们提出了CAMEL，一种仅使用图像级标签的弱监督学习框架，用于组织病理学图像分割。使用基于多实例学习(MIL)的标签丰富，CAMEL将图像分割成网格实例，并自动生成实例级标签。在标签富集之后，实例级标签被进一步分配给相应的像素，产生近似的像素级标签，并使得分割模型的完全监督训练成为可能。在CAMELYON16和结肠直肠腺瘤数据集上，CAMEL在实例级分类和像素级分割方面都达到了与完全监督方法相当的性能。此外，自动标记方法的普遍性可能有益于组织病理学图像分析的未来弱监督学习研究。



代码链接:https://github.com/ThoroughImages/CAMEL (实际上作者并没有更新代码…)



数据集:The dataset is hosted on [Google Drive](https://drive.google.com/open?id=1brr8CnU6ddzAYT157wkdXjbSzoiIDF9y) or [Baidu Drive](https://pan.baidu.com/s/1kk3rUgFkY7b3FX9g--w_5g) with password x2o5.



简要评价:

1. 利用 Max-Min 策略训练组合多实例学习决策边界,第二步使用分类伪标签训练分割网络
2. 发表在 ICCV2019
3. 利用分类标签进行语义分割
4. 级联多实例学习框架
5. 肿瘤分割任务





------

## 核心点总览

在这篇文章中，提出了一个弱监督学习框架CAMEL，用于仅使用图像级标签的组织病理学图像分割。CAMEL由两个步骤组成:标签富集和分割(图1)。CAMEL没有引入更多的监督约束，而是将图像分割成网格实例，并在标签富集步骤中自动生成它们的实例级标签，这可以被视为弱监督分类问题的解决方案。在标签丰富步骤中，我们使用组合多实例学习(cMIL)方法，从原始图像级数据集构建具有实例级标签的高质量实例级数据集。

![img](https://cy-1256894686.cos.ap-beijing.myqcloud.com/1626246377234-c9ee8a0b-7f31-4fff-8c55-d26ebf6d801c.png)

1. 在 Label Enrichment 阶段, 利用 Max-Min 策略,得到阳性包的阳性概率最高实例和阴性包的阳性概率最高最低实例,然后打上伪标签重新训练分类器
2. 使用级联 MIL 分类器,进一步细化 patch 标签
3. 在分割阶段,直接利用上一步 MIL 得到的 patch 级标签生成伪实例标注,训练分割网络(这一步没什么技术含量)



![img](https://cy-1256894686.cos.ap-beijing.myqcloud.com/1626245675749-b1832803-3c6d-4e05-92a6-74b81808f99c.png)



## 背景介绍

病理学图像的标注信息高度依赖于大量像素级标签的可用性，这是劳动密集型和耗时的.所以要用弱监督算法实现利用分类标签实现分割的效果.



## 算法实现

红色圆圈和绿色圆圈分别代表CA实例和NC实例。我们用三角形来表示选中的实例，用浅色的圆来表示未选中的实例。每条虚线代表分类器的决策边界
![bg right:60% 110%](https://cy-1256894686.cos.ap-beijing.myqcloud.com/20210306180524.png)

### Max-Max 策略

$$
S_{M a x-M a x}\left(\left\{f\left(b_{i}\right)\right\}\right)=\max _{i}\left\{f\left(b_{i}\right)\right\}
$$

### Max-Min 策略

$$
S_{M a x-M i n}\left(\left\{f\left(b_{i}\right)\right\}\right)=\left\{\begin{array}{ll}
\max _{i}\left\{f\left(b_{i}\right)\right\} & \text { if } y=1 \\
\min _{i}\left\{f\left(b_{i}\right)\right\} & \text { if } y=0
\end{array}\right.
$$



### 损失函数



![img](https://cy-1256894686.cos.ap-beijing.myqcloud.com/1626247767675-ffb031c5-91e8-46ef-8de7-0837454fea16.png)

学习出一个组合多实例学习决策边界,cMIL,考虑阳性包的高阳性实例和阴性包的最高最低实例组合的决策.





![img](https://cy-1256894686.cos.ap-beijing.myqcloud.com/1626246921865-10108585-1a47-4ecb-af69-ca81b66c6123.png)

### 多级 MIL

![img](https://cy-1256894686.cos.ap-beijing.myqcloud.com/1626246617338-8714ff93-7088-44bf-892f-54bce977d7f2.png)

## 实验对比分析

### 弱监督分类

![image-20210724133842193](https://cy-1256894686.cos.ap-beijing.myqcloud.com/image-20210724133842193.png)

![img](https://cy-1256894686.cos.ap-beijing.myqcloud.com/1626246865756-65a0a898-ff9d-4a4c-9441-13ff3a3099dd.png)

在CAMELYON16 上进行了实验，这是一个公共数据集，包含400张淋巴结切片的苏木精-伊红染色全切片图像。在本研究中，与CDWS-MIL[13]相同，将WSIs中大小为20倍的1，280×1，280个补丁视为图像级数据。CAMELYON16的训练集包含240个WSIs (110个包含CA)，将其拆分为5，011个CA和96，496个NC 1，280×1，280个Patch，并对CA Patch进行过采样以匹配NCPatch的数量。此外，还构建了另外两个包含320×320和160×160个实例的全监督训练集来帮助构建全监督基线。测试集包括160个WSIs (49个包含CA)，拆分并选择所有的3，392个1，280×1，280个CA补丁，然后随机抽取NC补丁进行编号。将1，280×1，280的Patch进一步拆分为320×320和160×160的大小，以测试具有相应输入大小的模型。如果补丁和实例包含任何癌性区域，则将其标记为CA。否则，标签为NC。



### 弱监督分割

![image-20210724134050384](https://cy-1256894686.cos.ap-beijing.myqcloud.com/image-20210724134050384.png)

![image-20210724134205187](https://cy-1256894686.cos.ap-beijing.myqcloud.com/image-20210724134205187.png)

可以看得出弱监督分割结果能接近全监督分割算法的性能



## 总结

组织病理学图像的计算机辅助诊断可以提高诊断的准确性，同时减轻病理学家的负担。在这项研究中，提出了一个弱监督学习框架CAMEL，用于仅使用图像级标签的组织病理学图像分割。CAMEL高质量地从图像级到实例级自动丰富监督信息，并获得与其完全监督的对应部分相当的分割结果。更重要的是，自动标记方法可以推广到其他用于组织病理学图像分析的弱监督学习研究。在CAMEL中，获得的实例级标签被直接分配给相应的像素，并在分割任务中用作掩码，这可能会导致过度标记的问题。

### 附录

CAMELYON16&17 在数字病理学中,相当于是自然场景图像的 ImageNet和 COCO,

CAMELYON 数据集包含分类和分割标签

### CAMELYON16 数据集背景知识

Rules for assigning clusters of metastasized tumor cells to a metastasis category

| **Category**         | **Size**                                                     |
| -------------------- | ------------------------------------------------------------ |
| Macro-metastasis     | Larger than 2 mm                                             |
| Micro-metastasis     | Larger than 0.2 mm and/or containing more than 200 cells, but not larger than 2 mm |
| Isolated tumor cells | Single tumor cells or a cluster of tumor cells not larger than 0.2 mm or less than 200 cells |

------

### CAMELYON 16 数据集介绍

WSI-level characteristics for the CAMELYON16 part of the dataset

|        |            | **Metastases** |       |       |
| ------ | ---------- | -------------- | ----- | ----- |
| Center | Total WSIs | None           | Macro | Micro |
| RUMC   | 249        | 150            | 48    | 51    |
| UMCU   | 150        | 90             | 34    | 26    |

![img](https://cy-1256894686.cos.ap-beijing.myqcloud.com/1627016682887-fec6cfc1-4612-4ae9-a9d3-ae291b163886.png)

[1]:1399 H&E-stained sentinel lymph node sections of breast cancer patients: the CAMELYON dataset

